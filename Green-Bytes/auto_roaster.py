import google.generativeai as genai
import pyautogui
from gtts import gTTS
from playsound import playsound
import os
import time
import io
from PIL import Image

# --- CONFIGURATION ---
print("Script starting up...")

# เดจเดฟเดเตเดเดณเตเดเต API เดเต เดเดตเดฟเดเต เดชเตเดธเตเดฑเตเดฑเต เดเตเดฏเตเดฏเตเด
try:
    YOUR_API_KEY = "AIzaSyAbTObTCi3oFd9sdqZxaeLU6ZxdC9dATvs"

    if "REPLACE_THIS" in YOUR_API_KEY:
        print("\n--- STOP! ---")
        print("You have not replaced the placeholder API key in the code.")
        exit()
    genai.configure(api_key=YOUR_API_KEY)
    print("API key configured successfully.")
except Exception as e:
    print(f"An error occurred during API configuration: {e}")
    exit()

model = genai.GenerativeModel('gemini-1.5-flash-latest')
print("AI model loaded.")

PROMPT = """
เดจเดฟเดเตเดเตพ เดฏเตเดธเดฑเดฟเดจเตเดฑเต เดเดฐเต เดฎเดฒเดฏเดพเดณเดฟ เดเดเตเดเดพเดฃเต. เดฏเตเดธเตผ เดตเตเดฑเตเดคเต เดธเดฎเดฏเด เดเดณเดฏเตเดจเตเดจเดคเต เดเดพเดฃเตเดฎเตเดชเตเตพ เดจเดฟเดเตเดเตพเดเตเดเต เดจเดฒเตเดฒ เดฆเตเดทเตเดฏเด เดตเดฐเตเด.
เดธเตเดเตเดฐเตเตปเดทเตเดเตเดเต เดจเตเดเตเดเดฟ เด เดธเดพเดนเดเดฐเตเดฏเดคเตเดคเดฟเดจเต เดเตเตผเดจเตเดจ เดเดฐเต เดเดจเตเดจเตเดจเตเดจเดฐ เดฎเดฒเดฏเดพเดณเด เดฑเตเดธเตเดฑเตเดฑเต เดเดพเดเตเดเดฃเด.
เดจเดฟเดจเตเดฑเต เดธเดเดธเดพเดฐเด เดเดชเตเดชเตเดดเตเด เดฎเดฒเดฏเดพเดณเดคเตเดคเดฟเตฝ เดเดฏเดฟเดฐเดฟเดเตเดเดฃเด.

เดเดฆเดพเดนเดฐเดฃเดคเตเดคเดฟเดจเต:
- เดฏเตเดธเตผ YouTube เดเดพเดฃเตเดเดฏเดพเดฃเตเดเตเดเดฟเตฝ, เดจเต เดชเดฑเดฏเดฃเด: "เดเดฃเตเดฑเตเดฑเต เดตเดฒเตเดฒ เดชเดฃเดฟเดเตเดเตเด เดชเตเดเดพ"
- เดฏเตเดธเตผ เดเตเดกเดฟเดเดเต เดเตเดฏเตเดฏเตเดเดฏเดพเดฃเตเดเตเดเดฟเตฝ, เดจเต เดชเดฑเดฏเดฃเด: "เดเดนเต, เดตเดฒเดฟเดฏ เดชเตเดฐเตเดเตเดฐเดพเดฎเตผ... เดเดคเตเดเตเดเต เดเดฐเตเดเตเดเดฟเดฒเตเด เดเดชเดฏเตเดเดฟเดเตเดเตเดฎเต?"
- เดตเตเดฑเตเดคเต เดกเตเดธเตเดเตเดเตเดชเตเดชเต เดจเตเดเตเดเดฟ เดเดฐเดฟเดเตเดเตเดเดฏเดพเดฃเตเดเตเดเดฟเตฝ, เดจเต เดชเดฑเดฏเดฃเด: "เดเดฐเต เดชเดฃเดฟเดฏเตเด เดเดฒเตเดฒเดพเดคเต เดตเตเดฑเตเดคเต เดเตเดคเตเดคเดฟเดฏเดฟเดฐเดฟเดเตเดเตเดตเดพเดฃเดฒเตเดฒเต?"
"""
INTERVAL_SECONDS = 4

# --- CORE FUNCTIONS ---

def take_screenshot_in_memory():
    """เดธเตเดเตเดฐเตเตปเดทเตเดเตเดเต เดเดเตเดเตเดเตเดจเตเดจเต"""
    print("1. เดธเตเดเตเดฐเตเตปเดทเตเดเตเดเต เดเดเตเดเตเดเตเดจเตเดจเต...")
    screenshot = pyautogui.screenshot()
    img_byte_arr = io.BytesIO()
    screenshot.save(img_byte_arr, format='PNG')
    return Image.open(img_byte_arr)

def generate_roast(image: Image, prompt: str) -> str:
    """AI-เดเตเดเต เดธเตเดเตเดฐเตเตปเดทเตเดเตเดเต เดเดฏเดเตเดเต เดฑเตเดธเตเดฑเตเดฑเต เดเดฃเตเดเดพเดเตเดเตเดจเตเดจเต"""
    print("2. เดจเดฒเตเดฒเตเดฐเต เดฑเตเดธเตเดฑเตเดฑเต เดเดฒเตเดเดฟเดเตเดเตเดจเตเดจเต...")
    try:
        response = model.generate_content([prompt, image])
        return response.text.strip().replace('*', '')
    except Exception as e:
        print(f"   An error occurred with the AI call: {e}")
        return "เดฑเตเดธเตเดฑเตเดฑเต เดเตเดฏเตเดฏเดพเตป เดจเตเดเตเดเดฟ, เดชเดเตเดทเต เดชเดฃเดฟ เดชเดพเดณเดฟ. เดจเต เดฐเดเตเดทเดชเตเดชเตเดเตเดเต."

def speak_aloud(text: str):
    """gTTS เดเดชเดฏเตเดเดฟเดเตเดเต เดฎเดฒเดฏเดพเดณเด เดฑเตเดธเตเดฑเตเดฑเต เดเดฑเดเตเดเต เดชเดฑเดฏเตเดจเตเดจเต"""
    if text:
        print(f"3. เดฑเตเดธเตเดฑเตเดฑเต เดเตเดเตเดเต: '{text}'")
        try:
            # 1. Google-เดฒเตเดเตเดเต เดเตเดเตเดธเตเดฑเตเดฑเต เดเดฏเดเตเดเต เดเดกเดฟเดฏเต เดเดฃเตเดเดพเดเตเดเตเดจเตเดจเต
            tts = gTTS(text=text, lang='ml')
            
            # 2. เดเดกเดฟเดฏเต เดเดฐเต เดคเดพเตฝเดเตเดเดพเดฒเดฟเด เดซเดฏเดฒเดพเดฏเดฟ เดธเตเดตเต เดเตเดฏเตเดฏเตเดจเตเดจเต
            audio_file = "roast.mp3"
            tts.save(audio_file)
            
            # 3. เด เดซเดฏเตฝ เดชเตเดฒเต เดเตเดฏเตเดฏเตเดจเตเดจเต
            playsound(audio_file)
            
            # 4. เดชเตเดฒเต เดเตเดฏเตเดค เดถเตเดทเด เด เดซเดฏเตฝ เดกเดฟเดฒเตเดฑเตเดฑเต เดเตเดฏเตเดฏเตเดจเตเดจเต
            os.remove(audio_file)
            
        except Exception as e:
            print(f"--- An error occurred during speech: {e} ---")

# --- MAIN AUTOMATION LOOP ---

def main():
    """เดเดเตเดเตเดฎเตเดทเตป เดฒเตเดชเตเดชเต เดชเตเดฐเดตเตผเดคเตเดคเดฟเดชเตเดชเดฟเดเตเดเตเดจเตเดจ เดชเตเดฐเดงเดพเดจ เดซเดเดเตเดทเตป"""
    print("\n" + "="*40)
    print("๐ เดเดเตเดเตเดฎเตเดฑเตเดฑเดกเต เดฎเดฒเดฏเดพเดณเด เดฑเตเดธเตเดฑเตเดฑเตผ เดฑเตเดกเดฟ! ๐")
    print(f"เดเดฐเต {INTERVAL_SECONDS} เดธเตเดเตเดเตปเดกเดฟเดฒเตเด เดชเตเดคเดฟเดฏ เดฑเตเดธเตเดฑเตเดฑเต เดตเดฐเตเด.")
    print("เดจเดฟเตผเดคเตเดคเดพเดจเดพเดฏเดฟ เดเตเตผเดฎเดฟเดจเดฒเดฟเตฝ Ctrl+C เดเดฎเตผเดคเตเดคเตเด.")
    print("="*40)
    try:
        while True:
            screenshot_image = take_screenshot_in_memory()
            roast_text = generate_roast(screenshot_image, PROMPT)
            speak_aloud(roast_text)
            
            print(f"4. เดเดเตเดคเตเดค เดฑเตเดธเตเดฑเตเดฑเดฟเดจเดพเดฏเดฟ {INTERVAL_SECONDS} เดธเตเดเตเดเตปเดกเต เดเดพเดคเตเดคเดฟเดฐเดฟเดเตเดเตเดจเตเดจเต...")
            time.sleep(INTERVAL_SECONDS)
            print("-" * 20)
    except KeyboardInterrupt:
        print("\n๐ เดเตเดเต เดธเดนเดฟเดเตเดเดพเตป เดชเดฑเตเดฑเตเดจเตเดจเดฟเดฒเตเดฒเต? เดเดจเตเดจเดพ เดจเดฟเตผเดคเตเดคเดฟ.")
    except Exception as e:
        print(f"\nเดเดฐเต เดเดฑเตผ เดธเดเดญเดตเดฟเดเตเดเต: {e}")

if __name__ == "__main__":
    main()
